$(document).ready(function(){(function(){function my_dateTimePicker(target,action,properties){if(typeof action=="string")switch(action){case "has-mirror":return hasMirror(target);break;case "mirror":if(typeof properties!="object")throw"Undefined properties for action mirror";if(!("to"in properties))throw'Undefined property "to" for action mirror';handleMirrors(target,properties);break}else{if(typeof action!="object")throw"Invalid properties given";if(!("date"in action)||action.date.__proto__.constructor!=
Date)action.date=new Date;createDateTime(target,action)}return target}function createDateTime(target,properties){if(typeof target=="undefined")throw"Could not find form element";if(typeof target.attr("name")=="undefined")throw"Please name your input";target.after(calendar_template.replace(/##target##/,target.attr("name").trim()).replace(/##months##/,function(){return generateMonthsOptions(properties.date)}).replace(/##years##/,function(){return generateYearsOptions(properties.date)}).replace(/##tableStyle##/g,
function(){return getTableStyle(properties)}).replace(/##dates##/,generateDateHeaders).replace(/##weeks##/,function(){return generateWeeks(properties.date)}).replace(/##timePanel##/,function(){return generateTimePanel(properties)}).replace(/##bottomFuncs##/,function(){return createBottomFunctionsContainer(properties)}));var currentPicker=$(".ui-datepicker:last");var data={picker:currentPicker,date:null,withTime:"with_time"in properties,format:null};if("mirror"in properties)if(typeof properties.mirror==
"object"&&"to"in properties.mirror)$(window).ready(function(){handleMirrors(target,properties["mirror"])});if("before"in properties)data.before=$(properties.before);if("after"in properties)data.after=$(properties.after);if(!("format"in properties))data.format="dd/mm/yyyy hh:ii:ss";datePairs[target.attr("name")]=data;target.on("click",function(){openPicker(target)}).on("change",function(){var pair=datePairs[target.attr("name")];var value=target.val().trim();if(value){var formatStructure=decomposeFormat(pair.format);
value=value.split(" ");if(value.length<formatStructure.length)for(var i=value.length;i<formatStructure.length;i++){var tmp=[];for(var j in formatStructure[i].structure)if(formatStructure[i].structure.hasOwnProperty(j))switch(formatStructure[i].structure[j]){case "hh":case "ii":case "ss":tmp.push("00")}value.push(tmp.join(formatStructure[i].separator))}if(value.length==formatStructure.length){analyzeDateInput(pair,value,formatStructure);restructureDate(pair,formatStructure);setDateToSibling(pair)}}else pair.date=
null;$(this).trigger("date:updated")}).on("focusin",function(){$(".ui-datepicker").hide();openPicker(target)});$(document).on("click",function(e){if(datePairs[target.attr("name")].picker.css("display")!="none")if(!(target.is(e.target)||datePairs[target.attr("name")].picker.is(e.target)||datePairs[target.attr("name")].picker.has(e.target).length>0))datePairs[target.attr("name")].picker.hide()})}function generateMonthsOptions(currentDate){var tmp="";for(var i in months)if(months.hasOwnProperty(i))tmp+=
'\x3coption value\x3d"'+i+'" '+(currentDate.getMonth()==i?"selected":"")+"\x3e"+months[i]+"\x3c/option\x3e";return tmp}function generateYearsOptions(currentDate){var tmp="";for(var i=currentDate.getFullYear()-10;i<=currentDate.getFullYear()+10;i++)tmp+='\x3coption value\x3d"'+i+'" '+(currentDate.getFullYear()==i?"selected":"")+"\x3e"+i+"\x3c/option\x3e";return tmp}function getTableStyle(properties){var tmp={};if("with_time"in properties)tmp.margin=0;if($.isEmptyObject(tmp))return"";else return'style\x3d"'+
JSON.stringify(tmp).replace(/,"/g,";").replace(/":/g,":").replace(/{"|}/g,"")+'"'}function generateDateHeaders(){var tmp="";for(var i in dates)if(dates.hasOwnProperty(i))tmp+=dates_template.replace("##dateTitle##",i).replace("##date##",dates[i]);return tmp}function generateWeeks(currentDate,target){var firstDay=new Date(currentDate.getFullYear(),currentDate.getMonth(),1);var lastDay=new Date(currentDate.getFullYear(),currentDate.getMonth()+1,0);var currentMonth=new month;var index=0;var tmp$jscomp$0=
[];var selected=false;var targetDate=null;var disabledDirection=[];if(typeof target!="undefined"){if(target.date!=null){selected=currentDate.getFullYear()==target.date.getFullYear()&&currentDate.getMonth()==target.date.getMonth();targetDate=target.date.getDate()}if("before_date"in target&&typeof target.before_date.getTime=="function")disabledDirection.push("before_date");if("after_date"in target&&typeof target.after_date.getTime=="function")disabledDirection.push("after_date")}currentMonth[1]=lastDay.getDate();
if(firstDay.getDay()>0){var lastMonthLastDay=new Date(currentDate.getFullYear(),currentDate.getMonth(),0);currentMonth[0]=-firstDay.getDay()+1}var currentMonthNum=currentDate.getMonth();for(var i=currentMonth[0];i<=currentMonth[1]+(6*7-currentMonth[1]);i++){if(i<1&&lastMonthLastDay)tmp$jscomp$0[index]={month:"last",month_num:currentMonthNum-1,year:currentMonthNum==0?"last":"current",selected:false,today:false,disabled:false,date:lastMonthLastDay.getDate()+i};else if(i<=currentMonth[1])tmp$jscomp$0[index]=
{month:"current",month_num:currentMonthNum,year:"current",selected:selected&&targetDate==i,today:currentDate.getDate()==i&&(typeof target=="undefined"||target.date==null)||typeof target!="undefined"&&selected==false&&targetDate==i,disabled:false,date:i};else tmp$jscomp$0[index]={month:"next",month_num:currentMonthNum+1,year:currentMonthNum==11?"next":"current",selected:false,today:false,disabled:false,date:i-currentMonth[1]};for(var direction in disabledDirection)if(disabledDirection.hasOwnProperty(direction)&&
tmp$jscomp$0[index].disabled===false){var testDate=new Date(target[disabledDirection[direction]]);var monthToChange=tmp$jscomp$0[index].month_num;var yearToChange=currentDate.getFullYear();if(monthToChange<0){monthToChange=11;yearToChange--}else if(monthToChange>11){monthToChange=0;yearToChange++}testDate.setDate(tmp$jscomp$0[index].date);testDate.setMonth(monthToChange);testDate.setFullYear(yearToChange);if(disabledDirection[direction]=="before_date"){if(testDate.getTime()<target[disabledDirection[direction]].getTime())tmp$jscomp$0[index].disabled=
true}else if(testDate.getTime()>target[disabledDirection[direction]].getTime())tmp$jscomp$0[index].disabled=true}index++}currentMonth=tmp$jscomp$0;tmp$jscomp$0="";for(i=0;i<6;i++)tmp$jscomp$0+=week_template.replace(/##days##/,function(){var tmp="";for(var j=0;j<7;j++){var index=i+j+(i?i*6:0);var day_classes="";var day_link_classes="";if(currentMonth[index].month!="current"){day_classes+=" ui-datepicker-other-month";day_link_classes+=" ui-priority-secondary"}if(currentMonth[index].disabled)day_classes+=
" ui-datepicker-unselectable ui-state-disabled";if(currentMonth[index].today&&currentMonth[index].disabled===false)day_link_classes+=" ui-state-highlight";if(currentMonth[index].selected)day_link_classes+=" ui-state-active";tmp+=day_template.replace(/##day##/g,currentMonth[index].date).replace(/##day_classes##/,day_classes.trim()).replace(/##day_link_classes##/,day_link_classes.trim()).replace(/##month##/,function(){var month=currentDate.getMonth();switch(currentMonth[index].month){case "last":month-=
1;break;case "next":month+=1;break}if(month<0)month=11;else if(month>11)month=0;return month}).replace(/##year##/,function(){var year=parseInt(currentDate.getFullYear());switch(currentMonth[index].year){case "last":year-=1;break;case "next":year+=1;break}return year})}return tmp});return tmp$jscomp$0}function generateTimePanel(properties){if(!("with_time"in properties))return"";return times_template.replace(/##hours##/,function(){return generateHoursOptions(properties.date)}).replace(/##minutes##/,
function(){return generateMinutesOptions(properties.date)}).replace(/##seconds##/,function(){return generateSecondsOptions(properties.date)})}function generateHoursOptions(currentDate){var current=currentDate.getHours();var tmp="";for(var i=0;i<24;i++)tmp+='\x3coption value\x3d"'+i+'" '+(i==current?"selected":"")+"\x3e"+(i<10?0:"")+i+"\x3c/option\x3e";return tmp}function generateMinutesOptions(currentDate){var current=currentDate.getMinutes();var tmp="";for(var i=0;i<60;i++)tmp+='\x3coption value\x3d"'+
i+'" '+(i==current?"selected":"")+"\x3e"+(i<10?0:"")+i+"\x3c/option\x3e";return tmp}function generateSecondsOptions(currentDate){var current=currentDate.getSeconds();var tmp="";for(var i=0;i<60;i++)tmp+='\x3coption value\x3d"'+i+'" '+(i==current?"selected":"")+"\x3e"+(i<10?0:"")+i+"\x3c/option\x3e";return tmp}function createBottomFunctionsContainer(properties){if(!("buttons"in properties))if("selections"in properties)return createSelections(properties);else return"";return bottom_functions_template.replace(/##functions##/g,
function(){var tmp="";for(var i in properties.buttons)if(properties.buttons.hasOwnProperty(i))tmp+=createButton(properties.buttons[i]);if("selections"in properties)tmp+=createSelections(properties);return tmp})}function createButton(properties){if(!("classes"in properties)){console.error("Property classes is missing");return""}if(!("text"in properties)){console.error("Property text is missing");return""}if(!("callback"in properties)){console.error("Property callback is missing");return""}return button_template.replace(/##classes##/g,
properties.classes).replace(/##text##/g,properties.text)}function createSelections(properties){if(selections_enabled===false)return"";var selections='\x3cselect class\x3d"shortcuts"\x3e\x3coption value\x3d"" disabled selected\x3eTime presets\x3c/option\x3e';for(var i in properties.selections)if(properties.selections.hasOwnProperty(i))selections+='\x3coption value\x3d"'+properties.selections[i].toLowerCase().replace(/\s+/g," ").replace(/\s/g,"_")+'"\x3e'+properties.selections[i]+"\x3c/option\x3e";
selections+="\x3c/select\x3e";return selections}function getDate(obj){var container=obj.closest("td");var picker=container.closest(".ui-datepicker");var pair=datePairs[picker.attr("data-target")];picker.find(".ui-state-highlight").removeClass("ui-state-highlight");picker.find(".ui-state-active").removeClass("ui-state-active");obj.addClass("ui-state-active");if(pair.withTime)var date=new Date(container.attr("data-year"),container.attr("data-month"),container.attr("data-day"),picker.find(".ui-datepicker-hours").val(),
picker.find(".ui-datepicker-minutes").val(),picker.find(".ui-datepicker-seconds").val());else date=new Date(container.attr("data-year"),container.attr("data-month"),container.attr("data-day"),0,0,0);pair["date"]=date;setDateToInput(picker)}function setDateToInput(picker){var target=picker.attr("data-target");var pair=datePairs[target];var date=pair.date;if("before_date"in pair&&typeof pair.before_date.getTime=="function"||"after_date"in pair&&typeof pair.after_date.getTime=="function"){var currentIndex=
"before_date"in pair&&typeof pair.before_date.getTime=="function"?"before_date":"after_date";var constraintDate=pair[currentIndex];if(currentIndex=="before_date"&&date<constraintDate||currentIndex=="after_date"&&date>constraintDate)date=constraintDate;pair.date=date}target=$('[name\x3d"'+target+'"]');restructureDate(pair);target.trigger("date:updated");setDateToSibling(pair);picker.hide()}function setDateToSibling(pair){var dateTargets=[];if("before"in pair&&typeof pair.before.selector=="string")dateTargets.push("before");
if("after"in pair&&typeof pair.after.selector=="string")dateTargets.push("after");for(var i in dateTargets)if(dateTargets.hasOwnProperty(i)){var currentIndex=dateTargets[i];pair[currentIndex].each(function(){var trigger=$(this);var currentMonth=pair.date.getMonth();var currentYear=pair.date.getFullYear();var currentPair=datePairs[trigger.attr("name")];var picker=currentPair.picker;currentPair[currentIndex+"_date"]=pair.date;expandYearsBasedOnDate(currentPair,pair.date);clearDisabledMonthsAndYears(picker,
currentIndex+"_date",currentMonth,currentYear)})}}function clearDisabledMonthsAndYears(picker,currentIndex,currentMonth,currentYear){var pair=datePairs[picker.attr("data-target")];currentMonth=parseInt(currentMonth);currentYear=parseInt(currentYear);var monthPicker=picker.find(".ui-datepicker-month:first");if(currentIndex=="before_date"){if(currentYear==picker.find(".ui-datepicker-year").val()){if(pair.date)monthPicker.html(generateMonthsOptions(pair.date));picker.find(".ui-datepicker-month:first option").each(function(){var obj=
$(this);if(obj.val()<currentMonth)obj.remove()})}picker.find(".ui-datepicker-year:first option").each(function(){var obj=$(this);if(obj.val()<currentYear)obj.remove()})}else if(currentIndex=="after_date"){if(currentYear==picker.find(".ui-datepicker-year").val()){if(pair.date)monthPicker.html(generateMonthsOptions(pair.date));picker.find(".ui-datepicker-month:first option").each(function(){var obj=$(this);if(obj.val()>currentMonth)obj.remove()})}picker.find(".ui-datepicker-year:first option").each(function(){var obj=
$(this);if(obj.val()>currentYear)obj.remove()})}}function fixMonthsOnYearChange(obj,pair,picker){if("before_date"in pair&&typeof pair.before_date.getTime=="function"||"after_date"in pair&&typeof pair.after_date.getTime=="function"){var currentIndex="before_date"in pair&&typeof pair.before_date.getTime=="function"?"before_date":"after_date";var date=pair[currentIndex];var months=picker.find(".ui-datepicker-month:first");var selected=months.val();var currentYear=obj.val();if(date.getFullYear()!=currentYear)months.html(generateMonthsOptions(getPickerDateOrNew(pair))).val(selected);
else clearDisabledMonthsAndYears(picker,currentIndex,date.getMonth(),currentYear)}}function openPicker(target){var pair=datePairs[target.attr("name")];if(pair.picker.css("display")=="none"){var restoreDate=getPickerDateOrNew(pair,true);pair.picker.find(".ui-datepicker-month").val(restoreDate.getMonth());pair.picker.find(".ui-datepicker-year").val(restoreDate.getFullYear());if(pair.withTime){pair.picker.find(".ui-datepicker-hours").val(restoreDate.getHours());pair.picker.find(".ui-datepicker-minutes").val(restoreDate.getMinutes());
pair.picker.find(".ui-datepicker-seconds").val(restoreDate.getSeconds())}if(target.closest("div").css("position")=="relative"){pair.picker.find("tbody").html(generateWeeks(restoreDate,pair));previousNextButtonVisibilityHandler(pair.picker);var width=parseFloat(target.outerWidth()+1)/parseFloat($("body").css("font-size"));if(width<17)width=17;pair.picker.show().css({"position":"absolute","top":target.outerHeight(),"left":target.offset().left-target.closest("div").offset().left,"width":width+"rem"})}else;
}}function previousNextButtonVisibilityHandler(picker){var pair=datePairs[picker.attr("data-target")];if("before_date"in pair&&typeof pair.before_date.getTime=="function"||"after_date"in pair&&typeof pair.after_date.getTime=="function"){var dateTargets=[];var showButtons=true;if("before_date"in pair&&typeof pair.before_date.getTime=="function")dateTargets.push("before_date");if("after_date"in pair&&typeof pair.after_date.getTime=="function")dateTargets.push("after_date");for(var i in dateTargets)if(dateTargets.hasOwnProperty(i)){var disabledDirection=
dateTargets[i];if(typeof pair[disabledDirection]!="undefined"&&typeof pair[disabledDirection].getTime=="function"&&pair[disabledDirection].getMonth()==picker.find(".ui-datepicker-month").val()&&pair[disabledDirection].getFullYear()==picker.find(".ui-datepicker-year").val()){showButtons=false;if(disabledDirection=="after_date")picker.find(".ui-datepicker-next").hide();else picker.find(".ui-datepicker-prev").hide()}}if(showButtons)picker.find(".ui-datepicker-prev, .ui-datepicker-next").show()}else picker.find(".ui-datepicker-prev, .ui-datepicker-next").show()}
function handleShortcutSelection(obj){var shortcut=obj.val();var picker=obj.closest(".ui-datepicker");var pair=datePairs[picker.attr("data-target")];var date=getPickerDateOrNew(pair);var timeFrame=shortcut.match(shortcuts_lexicon.timeFrames.join("|"));if(timeFrame==null)throw"Time frame not in current lexicon";var timeSpecified=shortcut.match(shortcuts_lexicon.specificTimes.join("|"));var multipliers=shortcut.match(shortcuts_lexicon.multipliers.join("|"));var orders=shortcut.match(shortcuts_lexicon.orders.join("|"));
if(timeSpecified==null)handleShortcutsTimeFrame(timeFrame,multipliers,orders,date,picker);else{var hours=picker.find(".ui-datepicker-hours");var minutes=picker.find(".ui-datepicker-minutes");var seconds=picker.find(".ui-datepicker-seconds");switch(timeSpecified[0]){case "same_hour":hours.val(date.getHours());minutes.val(date.getMinutes());seconds.val(date.getSeconds());break;case "midnight":hours.val(0);minutes.val(0);seconds.val(0);break;case "midday":hours.val(12);minutes.val(0);seconds.val(0);
break}handleShortcutsTimeFrame(timeFrame,multipliers,orders,date,picker)}obj.val("")}function handleShortcutsTimeFrame(timeFrame,multipliers,orders,date,picker){var pair=datePairs[picker.attr("data-target")];var oldDate=pair.date;var current=new Date(date.getTime());switch(timeFrame[0]){case "today":break;case "tomorrow":current.setDate(current.getDate()+1);break;case "week":if(multipliers!=null)switch(multipliers[0]){case "two":multipliers=2;break;default:multipliers=1;break}else multipliers=1;current.setDate(current.getDate()+
7*multipliers);break;case "quarter":break}pair.date=current;picker.find("tbody").html(generateWeeks(current,pair));pair.date=oldDate}function getPickerDateOrNew(pair,checkRestrictions){var tmpDate=pair.date?pair.date:new Date;if(checkRestrictions===true)if("before_date"in pair&&tmpDate<pair.before_date)tmpDate=pair.before_date;else if("after_date"in pair&&tmpDate>pair.after_date)tmpDate=pair.after_date;return tmpDate}function decomposeFormat(format){var decomposed=[];format=format.replace(/\s+/g,
" ");if((new RegExp("s")).test(format))format=format.split(" ");else format=[format];for(var i in format)if(format.hasOwnProperty(i)){var currentFormat=format[i];var tmp={"structure":[],"separator":""};for(var j in format_lexicon)if(format_lexicon.hasOwnProperty(j)){var index=currentFormat.indexOf(format_lexicon[j]);if(index>-1){currentFormat=currentFormat.replace(format_lexicon[j],"");tmp.structure[index]=format_lexicon[j]}}tmp.structure=tmp.structure.filter(function(key){if(key)return key});var tmpSeparator=
"";for(j in currentFormat)if(currentFormat.hasOwnProperty(j))if(tmpSeparator==""||tmpSeparator==currentFormat[j])tmpSeparator=currentFormat[j];else throw'Invalid separator "'+currentFormat[j]+'"';tmp.separator=tmpSeparator;decomposed.push(tmp)}return decomposed}function analyzeDateInput(pair,input,format){for(var i in format)if(format.hasOwnProperty(i)){var tmp=input[i].trim().split(new RegExp(format[i].separator));if(tmp.length<format[i].structure.length)for(var j in format[i].structure)switch(format[i].structure[j]){case "dd":case "mm":case "yyyy":case "hh":case "ii":case "ss":tmp.push(0);
break}for(j in format[i].structure)if(format[i].structure.hasOwnProperty(j))switch(format[i].structure[j]){case "dd":var date=tmp[j];break;case "mm":var month=tmp[j]-1;break;case "yyyy":var year=tmp[j];break;case "hh":var hours=tmp[j];break;case "ii":var minutes=tmp[j];break;case "ss":var seconds=tmp[j];break}}pair.date=new Date(year,month,date,hours,minutes,seconds);expandYearsBasedOnDate(pair)}function restructureDate(pair,format){var display="";if(typeof format=="undefined")format=decomposeFormat(pair.format);
for(var i in format)if(format.hasOwnProperty(i)){var tmp=[];for(var j in format[i].structure)if(format[i].structure.hasOwnProperty(j))switch(format[i].structure[j]){case "dd":var date=pair.date.getDate();if(date<10)date="0"+date;tmp.push(date);break;case "mm":var month=pair.date.getMonth()+1;if(month<10)month="0"+month;tmp.push(month);break;case "yyyy":tmp.push(pair.date.getFullYear());break;case "hh":var hours=pair.date.getHours();if(hours<10)hours="0"+hours;tmp.push(hours);break;case "ii":var minutes=
pair.date.getMinutes();if(minutes<10)minutes="0"+minutes;tmp.push(minutes);break;case "ss":var seconds=pair.date.getSeconds();if(seconds<10)seconds="0"+seconds;tmp.push(seconds);break}display+=tmp.join(format[i].separator)+" "}$('[name\x3d"'+pair.picker.attr("data-target")+'"]').val(display.trim())}function expandYearsBasedOnDate(pair,date){var yearPicker=pair.picker.find(".ui-datepicker-year");var selectedYear=typeof date!="undefined"?date.getFullYear():pair.date.getFullYear();var firstYearOption=
yearPicker.find("option:not(:disabled):first");var firstYear=parseInt(firstYearOption.val());var lastYearOption=yearPicker.find("option:not(:disabled):last");var lastYear=parseInt(lastYearOption.val());var tmp="";if(selectedYear<firstYear){for(var i=selectedYear;i<firstYear;i++)tmp+='\x3coption value\x3d"'+i+'"\x3e'+i+"\x3c/option\x3e";firstYearOption.before(tmp)}else if(selectedYear>lastYear){for(i=lastYear;i<=selectedYear;i++)tmp+='\x3coption value\x3d"'+i+'"\x3e'+i+"\x3c/option\x3e";lastYearOption.after(tmp)}}
function handleMirrors(target,properties){var mirrorToSelector="#"+target.attr("id");var mirrorToTarget=$(properties.to);try{var mirrorToFound=$.grep($._data($(document)[0],"events")["date:updated"],function(n){return n.handler.name=="mirrorTo"&&n.selector==mirrorToSelector})}catch(er){mirrorToFound=[]}if(mirrorToFound.length){mirrorToTarget.disabled(false);$(document).off("date:updated",mirrorToSelector,mirrorTo)}else{mirrorToTarget.val(target.val()).change();mirrorToTarget.disabled(true);$(document).on("date:updated",
mirrorToSelector,properties,mirrorTo)}}function hasMirror(target){var mirrorToSelector="#"+target.attr("id");try{var mirrorToFound=$.grep($._data($(document)[0],"events")["date:updated"],function(n){return n.handler.name=="mirrorTo"&&n.selector==mirrorToSelector})}catch(er){mirrorToFound=[]}return mirrorToFound.length>0}function mirrorTo(e){var pair=datePairs[$(e.data.to).attr("name")];pair.date=datePairs[this.name].date;setDateToInput(pair.picker)}var calendar_template='\x3cdiv class\x3d"ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all" data-target\x3d"##target##" style\x3d"z-index: 100"\x3e\n'+
'            \x3cdiv class\x3d"ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-all"\x3e\x3ca class\x3d"ui-datepicker-prev ui-corner-all" data-handler\x3d"prev" data-event\x3d"click" title\x3d"Prev"\x3e\x3cspan class\x3d"ui-icon ui-icon-circle-triangle-w"\x3e\x3c/span\x3e\x3c/a\x3e\x3ca class\x3d"ui-datepicker-next ui-corner-all" data-handler\x3d"next" data-event\x3d"click" title\x3d"Next"\x3e\x3cspan class\x3d"ui-icon ui-icon-circle-triangle-e"\x3e\x3c/span\x3e\x3c/a\x3e\n'+'                \x3cdiv class\x3d"ui-datepicker-title"\x3e\x3cselect class\x3d"ui-datepicker-month"\x3e##months##\x3c/select\x3e\x3cselect class\x3d"ui-datepicker-year"\x3e##years##\x3c/select\x3e\x3c/div\x3e'+
"            \x3c/div\x3e\n"+'            \x3ctable class\x3d"ui-datepicker-calendar" ##tableStyle##\x3e\x3cthead\x3e\x3ctr\x3e##dates##\x3c/tr\x3e\x3c/thead\x3e\x3ctbody\x3e##weeks##\x3c/tbody\x3e\x3c/table\x3e'+"##timePanel####bottomFuncs##"+"        \x3c/div\x3e";var dates_template='\x3cth scope\x3d"col"\x3e\x3cspan title\x3d"##dateTitle##"\x3e##date##\x3c/span\x3e\x3c/th\x3e';var week_template="\x3ctr\x3e##days##\x3c/tr\x3e";var day_template='\x3ctd class\x3d"##day_classes##" data-handler\x3d"selectDay" data-event\x3d"click" data-day\x3d"##day##" data-month\x3d"##month##" data-year\x3d"##year##"\x3e\x3ca class\x3d"ui-state-default ##day_link_classes##" href\x3d"#"\x3e##day##\x3c/a\x3e\x3c/td\x3e';
var bottom_functions_template='\x3cdiv class\x3d"ui-datepicker-buttonpane ui-widget-content"\x3e##functions##\x3c/div\x3e';var button_template='\x3cbutton type\x3d"button" class\x3d"left ui-state-default ui-priority-secondary ##classes##"\x3e##text##\x3c/button\x3e';var times_template='\x3cdiv class\x3d"ui-datepicker-header ui-widget-header ui-helper-clearfix ui-corner-all"\x3e\n'+'\x3cdiv class\x3d"ui-datepicker-title" style\x3d"margin:0;"\x3e\x3cselect class\x3d"ui-datepicker-hours width-33"\x3e##hours##\x3c/select\x3e\x3cselect class\x3d"ui-datepicker-minutes width-33"\x3e##minutes##\x3c/select\x3e\x3cselect class\x3d"ui-datepicker-seconds width-33"\x3e##seconds##\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e';
var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var dates={"Sunday":"Su","Monday":"Mo","Tuesday":"Tu","Wednesday":"We","Thursday":"Th","Friday":"Fr","Saturday":"Sa"};var month=function(){return[1,28]};var selections_enabled=false;var shortcuts_lexicon={timeFrames:["today","tomorrow","week","quarter"],specificTimes:["same_hour","midnight","midday"],multipliers:["two"],orders:["first","second","third","forth"]};var format_lexicon=["dd","mm","yyyy","hh","ii","ss"];
datePairs={};$.fn.extend({my_dateTimePicker:function(action,properties){return my_dateTimePicker($(this),action,properties)}});$.extend({my_dateTimePicker:function(target,action,properties){return my_dateTimePicker(target,action,properties)}});$(document).on("mouseenter",".ui-datepicker td a",function(e){$(this).addClass("ui-state-hover")}).on("mouseleave",".ui-datepicker td a",function(e){$(this).removeClass("ui-state-hover")}).on("click",".ui-datepicker td a",function(e){e.preventDefault();getDate($(this))}).on("click",
".ui-datepicker-prev, .ui-datepicker-next",function(e){e.preventDefault();var obj=$(this);var picker=obj.closest(".ui-datepicker");var month_select=picker.find(".ui-datepicker-month:first");var month=month_select.val();var year_select=picker.find(".ui-datepicker-year:first");var year=year_select.val();var pair=datePairs[picker.attr("data-target")];var date=new Date;if(obj.hasClass("ui-datepicker-prev"))--month;else++month;if(month<0){month=11;--year}else if(month>11){month=0;++year}year_select.val(year);
fixMonthsOnYearChange(year_select,pair,picker);picker.attr("data-previous-year",year);month_select.val(month);date.setMonth(month);date.setFullYear(year);picker.find("tbody").html(generateWeeks(date,pair));previousNextButtonVisibilityHandler(picker);if(obj.hasClass("ui-datepicker-next")){if(month_select.find("option:selected").is(":last")&&year_select.find("option:selected").is(":last")){var nextYear=year_select.val()+1;year_select.append('\x3coption value\x3d"'+nextYear+'"\x3e'+nextYear+"\x3c/option\x3e")}}else if(month_select.find("option:selected").is(":first")&&
year_select.find("option:selected").is(":first")){var previousYear=year_select.val()-1;year_select.prepend('\x3coption value\x3d"'+previousYear+'"\x3e'+previousYear+"\x3c/option\x3e")}}).on("click",".today-button",function(e){e.preventDefault();var obj=$(this);var picker=obj.closest(".ui-datepicker");var pair=datePairs[picker.attr("data-target")];var date=new Date;picker.find(".ui-datepicker-month:first").val(date.getMonth());picker.find(".ui-datepicker-year:first").val(date.getFullYear());pair.date=
date;picker.find("tbody").html(generateWeeks(date,pair));previousNextButtonVisibilityHandler(picker);setDateToInput(picker)}).on("click",".now-button",function(e){e.preventDefault();var obj=$(this);var picker=obj.closest(".ui-datepicker");var pair=datePairs[picker.attr("data-target")];var date=new Date;picker.find(".ui-datepicker-month:first").val(date.getMonth());picker.find(".ui-datepicker-year:first").val(date.getFullYear());picker.find(".ui-datepicker-hours").val(date.getHours());picker.find(".ui-datepicker-minutes").val(date.getMinutes());
picker.find(".ui-datepicker-seconds").val(date.getSeconds());pair.date=date;picker.find("tbody").html(generateWeeks(date,pair));previousNextButtonVisibilityHandler(picker);setDateToInput(picker)}).on("change",".ui-datepicker-month, .ui-datepicker-year",function(){var obj=$(this);var picker=obj.closest(".ui-datepicker");var date=new Date;date.setMonth(picker.find(".ui-datepicker-month").val());date.setFullYear(picker.find(".ui-datepicker-year").val());picker.find("tbody").html(generateWeeks(date,datePairs[picker.attr("data-target")]));
previousNextButtonVisibilityHandler(picker);if(obj.hasClass("ui-datepicker-year")){var pair=datePairs[picker.attr("data-target")];fixMonthsOnYearChange(obj,pair,picker)}}).on("change",".shortcuts",function(){handleShortcutSelection($(this))})})()});
$(document).ready(function(){function clearProductListing(product_form){var product_prompt=product_form.find(".product_prompt");var product_container=product_form.find(".product_container");product_prompt.hide().find('[type\x3d"radio"]').prop("checked",false);product_container.hide()}function loadActionListBasedOnCategory(obj){var product_form=obj.closest(".product_form");var select_category=product_form.find(".select_category");var category=select_category.find("option:selected").text().trim().toLowerCase().replace(/\s/g,
"_");var select_action=product_form.find(".select_action");if(category in category_actions){product_form.find(".action_prompt").show();select_action.find("option:not(.permanent)").remove();for(var i in category_actions[category])if(category_actions[category].hasOwnProperty(i))select_action.append('\x3coption value\x3d"'+triggers.product_actions[category_actions[category][i]]["id"]+'"\x3e'+triggers.product_actions[category_actions[category][i]]["name"]+"\x3c/option\x3e");select_action.chosen_update("")}}
function clearActionListing(product_form){var action_prompt=product_form.find(".action_prompt");var action_container=product_form.find(".action_container");action_prompt.hide().find('[type\x3d"radio"]').prop("checked",false);action_container.hide()}function copyProductForm(container,template){container.find(".product_form:last").after(template.replace(/##enum##/g,container.find(".product_form").length+1));container.find(".product_form .remove").show();container.find(".product_form:last select").apply_chosen("");
$("#triggerCombinationMethod").show()}function removeProductForm(obj){var container=obj.closest(".product_form");var fieldset=container.closest("fieldset");var next=container.next(".product_form");if(next.length)container=moveNextToPrevious(next);container.remove();var removes=fieldset.find(".product_form .remove");if(removes.length==1){removes.hide();$("#triggerCombinationMethod").hide()}}function moveNextToPrevious(current){var form=[];current.find('[name^\x3d"trigger_category_prompt"]:checked');
current.find('[name^\x3d"trigger_product_prompt"]:checked');current.find('[name^\x3d"trigger_action_prompt"]:checked');current.find("input:not(.chosen-container input), select").each(function(){var obj=$(this);var target=$("#"+obj.attr("id").replace(/[0-9]+$/,function(num){return parseInt(num)-1}));if(obj.is("input")){if(obj.prop("checked"))target.click()}else{var val=obj.val();if(val)target.chosen_update(val).change()}});var next=current.next(".product_form");if(next.length)return moveNextToPrevious(next);
return current}function activatePrevious(obj){if(obj.length<1)return;obj.addClass("active");activatePrevious(obj.prev())}function deActivateNext(obj){if(obj.length<1)return;obj.removeClass("active");deActivateNext(obj.next())}function scrollToStep(){$(window).scrollTop($(".step:visible").offset().top)}$(".step-button").on("click",function(e){e.preventDefault();var obj=$(this);$(".step").hide();$("#"+obj.attr("data-target")).show();obj.addClass("active");activatePrevious(obj.prev());deActivateNext(obj.next())});
$("#trigger_start").my_dateTimePicker({date:new Date,with_time:true,buttons:[{classes:"today-button",text:"Today",callback:"today"},{classes:"now-button",text:"Now",callback:"now"}],"before":"#trigger_end","mirror":{"to":"#constraints_start"}});$("#trigger_end").my_dateTimePicker({date:new Date,with_time:true,buttons:[{classes:"today-button",text:"Today",callback:"today"},{classes:"now-button",text:"Now",callback:"now"}],"after":"#trigger_start","mirror":{"to":"#constraints_end"}});$("#constraints_start").my_dateTimePicker({date:new Date,
with_time:true,buttons:[{classes:"today-button",text:"Today",callback:"today"},{classes:"now-button",text:"Now",callback:"now"}],"before":"#constraints_end"});$("#constraints_end").my_dateTimePicker({date:new Date,with_time:true,buttons:[{classes:"today-button",text:"Today",callback:"today"},{classes:"now-button",text:"Now",callback:"now"}],"after":"#constraints_start"});$("#registered_from").my_dateTimePicker({date:new Date,with_time:true,buttons:[{classes:"today-button",text:"Today",callback:"today"},
{classes:"now-button",text:"Now",callback:"now"}],"before":"#registered_to"});$("#registered_to").my_dateTimePicker({date:new Date,with_time:true,buttons:[{classes:"today-button",text:"Today",callback:"today"},{classes:"now-button",text:"Now",callback:"now"}],"after":"#registered_from"});$(".step-buttons .button:not(#couponSubmit):not(.secondary)").on("click",function(e){e.preventDefault();$(".step-button.active").next(".step-button").click();scrollToStep()});$(".step-buttons .button.secondary").on("click",
function(e){e.preventDefault();$(".step-button.active").prev(".step-button").click();scrollToStep()});$(document).on("change",'[name*\x3d"category_prompt"]',function(){var obj=$(this);var product_form=obj.closest(".product_form");var category_container=product_form.find(".category_container");var action_prompt=product_form.find(".action_prompt");product_form.find(".select_category").chosen_update("");clearProductListing(product_form);if(obj.val()=="specify")category_container.show();else category_container.hide();
action_prompt.hide().find('[type\x3d"radio"]').prop("checked",false);var action=product_form.find(".action_container").hide().find(".select_action");action.find("option:not(.permanent)").remove();action.chosen_update("")}).on("change",".select_category",function(){var obj=$(this);var product_form=obj.closest(".product_form");var product_prompt=product_form.find(".product_prompt");var product_container=product_form.find(".product_container");var select_product=product_container.find(".select_product");
var action_prompt=product_form.find(".action_prompt");if(obj.val()!="currently_active"){product_prompt.show().find('[type\x3d"radio"]').prop("checked",false);clearActionListing(product_form);select_product.find("option:not(.permanent)").remove();if(!!obj.val()){$.each(triggers.product_categories[obj.val()].products,function(key,value){select_product.append('\x3coption value\x3d"'+value.id+'"\x3e'+value.name+"\x3c/option\x3e")});select_product.chosen_update("")}}else{clearProductListing(product_form);
action_prompt.show().find('[type\x3d"radio"]').prop("checked",false)}product_container.hide()}).on("change",'[name*\x3d"product_prompt"]',function(){var obj=$(this);var product_form=obj.closest(".product_form");var product_container=product_form.find(".product_container");if(obj.val()=="specify"){product_container.show();product_form.find(".select_action, .action_prompt").hide()}else{loadActionListBasedOnCategory(obj);product_container.hide().find("select").chosen_update("")}}).on("change",".select_product",
function(){loadActionListBasedOnCategory($(this))}).on("change",'[name*\x3d"action_prompt"]',function(){var obj=$(this);var product_form=obj.closest(".product_form");var action_container=product_form.find(".action_container");if(obj.val()=="specify")action_container.show().find("select").chosen_update("");else action_container.hide()});$("#coupon_create_form").prepare_form_advanced({outer_handlers:"#couponSubmit",disable:"#couponSubmit",version_exception:true,onSuccess:function(form){$("#couponSubmit").removeClass("disabled");
return $.coupon_create.submit(form)}}).off("onError").on("onError",function(){var form=$(this);form.handle_errors();$('[data-target\x3d"'+form.find(".error:first").closest(".step").attr("id")+'"]').click();form.find_errors(1E3)});var merge={copyProductForm:copyProductForm,removeProductForm:removeProductForm};if("coupon_create"in $)$.extend($.coupon_create,merge);else $.extend({"coupon_create":merge})});
$(window).on("load",function(){$("#trigger_minimum_duration, #constraints_minimum_duration, .select_category, .select_product, .select_action, #users_filter").each(function(){var obj=$(this);obj.apply_chosen(obj.val())})});
$(document).ready(function(){$("#auto-code-trigger").on("change",function(){var manualCodeCont=$("#manualCodeCont");var manual_code=$("#manual_code");if($(this).prop("checked")){manualCodeCont.hide();manual_code.removeAttr("data-override-visibility")}else{manualCodeCont.show();manual_code.attr("data-override-visibility",true)}});$("#status-trigger").on("change",function(){if($(this).prop("checked"))$("#activationWarning").hide();else $("#activationWarning").show()});$("#manual_code").on("change input",
function(){var obj=$(this);var matched=obj.val().match(/[\w0-9]+/g);obj.val(matched?matched.join("").toUpperCase():"")});$("#greek_title, #greek_description").on("change",function(){var obj=$(this);var target=$("#"+obj.attr("id").replace("greek","english"));if(obj.val().match(REG.ASCII.INVERSE.REGEX)==null)target.removeAttr("data-override-visibility");else target.attr("data-override-visibility",true)})});
$(document).ready(function(){function minTierAmountIsRequired(){var tierAmounts=$('[name^\x3d"trigger_amount_tier_"]');$(document).on("change",tierAmounts.selector,{},setMinAmountValidation)}function setMinAmountValidation(){var tierAmounts=$('[name^\x3d"trigger_amount_tier_"]');try{clearTimeout(triggerAmountTimer)}catch(e){}triggerAmountTimer=setTimeout(function(){var count=tierAmounts.filter(function(){return!!this.value}).length;if(count>0)tierAmounts.attr_app("data-validate"," required").attr("data-override-visibility",
true);else{tierAmounts.attr("data-validate",tierAmounts.attr("data-validate").replace("required","").trim());tierAmounts.removeAttr("data-override-visibility")}},250)}var step=$("#triggers_step");var triggerTemp=$("#triggers_step .product_form").getOuterHTML().replace(/_[0-9]+/g,"_##enum##").replace(/#[0-9]+/,"###enum##");$(document).on("click","#triggers_step .product_form .add",function(e){e.preventDefault();$(this).blur();$.coupon_create.copyProductForm(step,triggerTemp)}).on("click","#triggers_step .product_form .remove",
function(e){e.preventDefault();$.coupon_create.removeProductForm($(this).blur())});$('[name\x3d"trigger_target_type"]').on("change",function(){var execute={};if($('[name\x3d"trigger_target_type"]:checked').val()=="previous_order"){if($("#trigger_start").my_dateTimePicker("has-mirror"))execute.trigger_start="constraints_start";if($("#trigger_end").my_dateTimePicker("has-mirror"))execute.trigger_end="constraints_end"}else{if(!$("#trigger_start").my_dateTimePicker("has-mirror"))execute.trigger_start=
"constraints_start";if(!$("#trigger_end").my_dateTimePicker("has-mirror"))execute.trigger_end="constraints_end"}if(!$.isEmptyObject(execute))for(var i in execute)if(execute.hasOwnProperty(i))$("#"+i).my_dateTimePicker("mirror",{"to":"#"+execute[i]})});$('[name\x3d"apply_min_amount_to"]').on("change",function(){$(".min_amount_input_containers").hide().find("input").val("");$("#"+this.id+"_container").show();if(this.value=="each_tier")minTierAmountIsRequired();else{var tierAmounts=$('[name^\x3d"trigger_amount_tier_"]');
$(document).off("change",tierAmounts.selector,setMinAmountValidation);tierAmounts.attr("data-validate",tierAmounts.attr("data-validate").replace("required","").trim());tierAmounts.removeAttr("data-override-visibility")}})});
$(document).ready(function(){var step=$("#constraints_step");var constraintsTemp=$("#constraints_step .product_form").getOuterHTML().replace(/_[0-9]+/g,"_##enum##").replace(/#[0-9]+/,"###enum##");$(document).on("click","#constraints_step .product_form .add",function(e){e.preventDefault();$(this).blur();$.coupon_create.copyProductForm(step,constraintsTemp)}).on("click","#constraints_step .product_form .remove",function(e){e.preventDefault();$.coupon_create.removeProductForm($(this).blur())})});
$(document).ready(function(){var discountAmountContainer=$("#discountAmountContainer");var discountTiersContainer=$("#discountTiersContainer");var triggerAmountNotice=$("#triggerAmountNotice");$('[name\x3d"apply_to"]').on("change",function(){if($(this).val()=="apply_to_all"){discountAmountContainer.show().find("input").val("").attr("data-override-visibility",true);discountTiersContainer.hide().find("input").removeAttr("data-override-visibility")}else{discountAmountContainer.hide().find("input").removeAttr("data-override-visibility");
discountTiersContainer.show().find("input").val("").attr("data-override-visibility",true)}}).one("change",function(){$("#discountTypeContainer").show()});$('[name\x3d"discount_type"]').on("change",function(){if($(this).val()=="fixed")discountAmountContainer.find(".inline").translate("misc.amount");else discountAmountContainer.find(".inline").translate("misc.percentage")});$("#amount, #tier_1, #tier_2, #tier_3, #tier_4, #tier_5, #tier_6").on("change",function(){var obj=$(this);if(parseInt(obj.val())<=
0)obj.val(.01)});$(document).on("change",'[name\x3d"apply_min_amount_to"]',function(){triggerAmountNotice.hide()}).on("change","#trigger_amount",function(){var obj=$(this);if(obj.val()>0)triggerAmountNotice.show().find("span").text(obj.val()+$.html_encoder.decode("\x26euro;"));else triggerAmountNotice.hide()}).on("change",'[name^\x3d"trigger_amount_tier_"]',function(){var limits=[];$('[name^\x3d"trigger_amount_tier_"]').each(function(){if(this.value)limits.push(this.value)});if(limits.length<1)triggerAmountNotice.hide();
else{limits=$.unique(limits);if(limits.length==1)triggerAmountNotice.show().find("span").text(limits[0]+$.html_encoder.decode("\x26euro;"));else triggerAmountNotice.show().find("span").text(Math.min.apply(null,limits)+$.html_encoder.decode("\x26euro;")+$.html_encoder.decode("\x26dash;")+Math.max.apply(null,limits)+$.html_encoder.decode("\x26euro;"))}})});
$(document).ready(function(){function updateStatusDisplay(source){var status="";if(source.prop("checked"))status=success_status;else{var trigger_start=$("#trigger_start");if(trigger_start.val()){status=warning_status;$("#couponActivationDateContainer").show().find("#couponActivationDate").text(trigger_start.val())}else{status=success_status;$("#couponActivationDateContainer").hide()}}$('[data-for\x3d"'+source.attr("id")+'"]').html(status)}function cloneTriggerDisplay(){for(var i=$(".trigger_display").length+
1;i<=$("#triggers_step .product_form").length;i++)$(".trigger_display:last").after(trigger_display.replace(/##index##/g,i));displayTriggerChanges()}function removeTriggerDisplay(){for(var i=$(".trigger_display").length;i>$("#triggers_step .product_form").length;i--)$(".trigger_display:last").remove();displayTriggerChanges()}function cloneConstraintDisplay(){for(var i=$(".constraint_display").length+1;i<=$("#constraints_step .product_form").length;i++)$(".constraint_display:last").after(constraint_display.replace(/##index##/g,
i));displayConstraintChanges()}function removeConstraintDisplay(){for(var i=$(".constraint_display").length;i>$("#constraints_step .product_form").length;i--)$(".constraint_display:last").remove();displayConstraintChanges()}function displayTriggerChanges(){populateDisplay("triggers_step","trigger_display")}function displayConstraintChanges(){populateDisplay("constraints_step","constraint_display")}function populateDisplay(step,displays){var index=1;$("#"+step+" .product_form").each(function(){var obj=
$(this);var display=$("."+displays+'[data-index\x3d"'+index+'"]');display.find("[data-for]").each(function(){$(this).text($.html_encoder.decode("\x26ndash;"))});if(obj.find(":input").serialize()){obj.find("input:checked").each(function(){var input=$(this);display.find('[data-for\x3d"'+input.attr("name").replace(/_[0-9]+$/,"")+'"]').text(input.closest("label").text().trim())});obj.find("select").each(function(){var select=$(this);var text=[];select.find("option:selected:not(:disabled)").each(function(){var obj=
$(this);if(text.join(", ").length<50)text.push(obj.text().trim())});text=text.join(", ");if(select.attr("multiple"))if(select.hasClass("select_product"))if(text.length>50){text=text.slice(0,50)+"...";display.find(".more-products-container").show().find(".more-products").attr("data-target",select.attr("id"))}else display.find(".more-products-container").hide();if(text)display.find('[data-for\x3d"'+select.attr("id").replace(/_[0-9]+$/,"")+'"]').text(text);else display.find('[data-for\x3d"'+select.attr("id").replace(/_[0-9]+$/,
"")+'"]').text($.html_encoder.decode("\x26ndash;"))});display.show();index++}else display.hide()})}function submitCoupon(form){return function(){function serializeGeneral(){var tmp={"code":$("#manual_code").val(),"active":$("#status-trigger").prop("checked")||!trigger_start,"greek_title":$("#greek_title").val(),"greek_description":$("#greek_description").val(),"english_title":$("#english_title").val(),"english_description":$("#english_description").val(),"comment":$("#comment").val()};$.extend(data,
tmp)}function serializeTriggers(){var trigger_amount=$("#trigger_amount").val();var tmp={"trigger_coupon_type":$('[name\x3d"trigger_target_type"]:checked').val()=="previous_order"?1:2,"trigger_valid_from":trigger_start,"trigger_valid_to":$("#trigger_end").val(),"trigger_min_length":$("#trigger_minimum_duration").val(),"trigger_amount":{"tier":{}},"trigger_catalog_operator":$('[name\x3d"trigger_target_method"]:checked').val()=="and"?1:2,"trigger_catalog":[]};$.extend(data,tmp);$("#triggers_step .product_form").each(function(){var obj=
$(this);var select_category=obj.find(".select_category").val();var select_product=obj.find(".select_product").val();var select_action=obj.find(".select_action").val();if(!!select_category||!!select_product||!!select_action)data.trigger_catalog.push({"category_id":select_category,"product_id":!!select_product?select_product:[],"action_id":!!select_action?select_action:[]})});if($('[name\x3d"apply_min_amount_to"]:checked').val()=="all")for(var i=0;i<6;i++)data.trigger_amount.tier[i]=trigger_amount;
else $('[name^\x3d"trigger_amount_tier_"]').each(function(index){data.trigger_amount.tier[index]=this.value})}function serializeConstraints(){var tmp={"constraint_valid_from":$("#constraints_start").val(),"constraint_valid_to":$("#constraints_end").val(),"constraint_min_length":$("#constraints_minimum_duration").val(),"constraint_catalog":[]};$.extend(data,tmp);$("#constraints_step .product_form").each(function(){var obj=$(this);var select_category=obj.find(".select_category").val();var select_product=
obj.find(".select_product").val();var select_action=obj.find(".select_action").val();if(!!select_category||!!select_product||!!select_action)data.constraint_catalog.push({"category_id":select_category,"product_id":!!select_product?select_product:[],"action_id":!!select_action?select_action:[]})})}function serializeUsers(){var tmp={"max_use_global":$("#max_allowed_uses").val(),"max_use_per_user":$("#max_allowed_uses_per_user").val(),"max_use_per_item":$("#max_allowed_uses_per_item").val(),"allow_on_offer":$("#combine_offer").prop("checked"),
"allow_on_coupon":$("#combine_coupons").prop("checked"),"trigger_on_user_custom_price":$("#trigger_on_user_custom_price").prop("checked")};$.extend(data,tmp);if($("#all-users-trigger").prop("checked"))data.all_users=true;else{var userFilters=$('[name\x3d"users_selection"]:checked');var value=null;if(userFilters.length<1)data.all_users=true;else{data.all_users=false;if(userFilters.val()=="list"){value=$("#users_filter").val();if(!!value)data.users=value;else data.all_users=true}else{var filters={};
var activeFilters=$("#users_step .activate_filters:checked");if(activeFilters.length<1)data.all_users=true;else{activeFilters.each(function(){var obj=$(this);var filter=null;var limits={};if(obj.attr("name").indexOf("registration")>-1){filter=$('[name\x3d"registration_filter"]:checked').val();if(!filter)return true;if(filter.toLowerCase().indexOf("between")>-1){var registered_from=$('[name\x3d"registered_from"]').val();var registered_to=$('[name\x3d"registered_to"]').val();if(!!registered_from)limits["from"]=
registered_from;if(!!registered_to)limits["to"]=registered_to;if(!$.isEmptyObject(limits))filters[filter]=limits}else filters[filter]=true}else{filter=$('[name\x3d"orders_filter"]:checked').val();if(!filter)return true;if(filter.toLowerCase().indexOf("total")>-1){var amount_from=$('[name\x3d"amount_from"]').val();var amount_to=$('[name\x3d"amount_to"]').val();if(!!amount_from)limits["from"]=amount_from;if(!!amount_to)limits["to"]=amount_to;if(!$.isEmptyObject(limits))filters[filter]=limits}else filters[filter]=
true}});if(!$.isEmptyObject(filters))data.filter_users=filters;else data.all_users=true}}}}}function serializeFinances(){var tmp={"amount":{"discount_type":$('[name\x3d"discount_type"]:checked').val(),"tier":[]}};$.extend(data,tmp);if($('[name\x3d"apply_to"]:checked').val()=="apply_to_all"){var amount=$("#amount").val();for(var i=0;i<6;i++)data.amount.tier.push(amount)}else $(".tier_amount").each(function(){data.amount.tier.push($(this).val())})}var data={};var trigger_start=$("#trigger_start").val();
serializeGeneral();serializeTriggers();serializeConstraints();serializeUsers();serializeFinances();console.log(data);$.ajax(new $.ajax_prototype({"type":"POST","data":data,"success":function(data){console.log(data)}},form.attr("id")))}()}var check='\x3ci class\x3d"check icon-checkmark"\x3e\x3c/i\x3e';var unavail='\x3ci class\x3d"unavail icon-cross3"\x3e\x3c/i\x3e';var success_status='\x3cdiv class\x3d"label success align-left"\x3e'+$.translate("coupons.create.status.active")+"\x3c/div\x3e";var warning_status=
'\x3cdiv class\x3d"label warning align-left"\x3e'+$.translate("coupons.create.status.warning")+"\x3c/div\x3e";var accountLink='\x3ca href\x3d"'+$urls["userDashboard"]+'" title\x3d"##text##" target\x3d"_blank"\x3e##text##\x3c/a\x3e';var trigger_display=$(".trigger_display").getOuterHTML().replace(/"[0-9]+"/g,"##index##").replace(/#[0-9]+/g,"###index##");var constraint_display=$(".constraint_display").getOuterHTML().replace(/"[0-9]+"/g,"##index##").replace(/#[0-9]+/g,"###index##");var allSelectedProducts=
$("#allSelectedProducts");$("#coupon_create_form").on("change date:updated",function(e){var source=$(e.target);var source_id=source.attr("id");var shift=source_id;if(source.is('[type\x3d"radio"]'))shift=source.attr("name");if(shift)switch(shift){case "manual_code":case "greek_title":case "english_title":case "greek_description":case "english_description":case "comment":case "trigger_amount":case "max_allowed_uses":case "max_allowed_uses_per_user":case "max_allowed_uses_per_item":var value=source.val();
if(value){switch(shift){case "trigger_amount":value+=$.html_encoder.decode("\x26euro;");break}$('[data-for\x3d"'+shift+'"]').text(value)}break;case "auto-code-trigger":if(source.prop("checked"))$("#manual_code").val(source.val()).change();break;case "trigger_target_type":case "trigger_target_method":$('[data-for\x3d"'+shift+'"]').text(source.next("span").text());break;case "trigger_minimum_duration":case "constraints_minimum_duration":$('[data-for\x3d"'+shift+'"]').text(source.find("option:selected").text());
break;case "trigger_start":case "trigger_end":var period=[];var trigger_start=$("#trigger_start").val();var trigger_end=$("#trigger_end").val();if(trigger_start)period.push($.translate("coupons.create.from")+" "+trigger_start);if(trigger_end)period.push($.translate("coupons.create.from")+" "+trigger_end);updateStatusDisplay($("#status-trigger"));$('[data-for\x3d"trigger_validity_period"]').text(period.join(" - "));break;case "apply_min_amount_to":$(".min_length_result").hide().find("[data-for]").text(0+
$.html_encoder.decode("\x26euro;"));$("#"+$('[name\x3d"apply_min_amount_to"]:checked').attr("id")+"_result").show();break;case "trigger_amount_tier_1":case "trigger_amount_tier_2":case "trigger_amount_tier_3":case "trigger_amount_tier_4":case "trigger_amount_tier_5":case "trigger_amount_tier_6":$('[name^\x3d"trigger_amount_tier_"]').each(function(){$('[data-for\x3d"'+this.name+'"]').text((this.value?this.value:0)+$.html_encoder.decode("\x26euro;"))});break;case "constraints_start":case "constraints_end":period=
[];var constraints_start=$("#constraints_start").val();var constraints_end=$("#constraints_end").val();if(constraints_start)period.push($.translate("coupons.create.from")+" "+constraints_start);if(constraints_end)period.push($.translate("coupons.create.from")+" "+constraints_end);$('[data-for\x3d"constraint_validity_period"]').text(period.join(" - "));break;case "all-users-trigger":$('[data-for\x3d"selectedUsers"]').translate("coupons.create.all_users");$("#userFiltersContainer").hide();break;case "users_filter":var display$jscomp$0=
[];var list=[];var selections=source.find("option:selected");if(!!source.val()===false){$('[data-for\x3d"selectedUsers"]').translate("coupons.create.all_users");$("#seeAllSelectedUsers").hide();break}for(var i=0;i<2;i++)if(selections[i]){var obj$jscomp$0=$(selections[i]);display$jscomp$0.push(accountLink.replace("##userid##",obj$jscomp$0.val()).replace(/##text##/g,obj$jscomp$0.text()))}display$jscomp$0=display$jscomp$0.join(", ");if(selections.length>2){display$jscomp$0+=" ...";selections.each(function(){var obj=
$(this);list.push("\x3cli\x3e"+accountLink.replace("##userid##",obj.val()).replace(/##text##/g,obj.text())+"\x3c/li\x3e")});$("#seeAllSelectedUsers").show()}else $("#seeAllSelectedUsers").hide();$('[data-for\x3d"selectedUsers"]').html(display$jscomp$0);$("#allUsersList").html(list.join(""));break;case "users_selection":obj$jscomp$0=$('[name\x3d"users_selection"]:checked');var userFiltersContainer=$("#userFiltersContainer");$('[data-for\x3d"selectedUsers"]').translate("coupons.create.all_users");if(obj$jscomp$0.val()==
"list")userFiltersContainer.hide();else userFiltersContainer.show().find("[data-for]").text($.html_encoder.decode("\x26ndash;"));break;case "registration_filter":(function(){var obj=$('[name\x3d"registration_filter"]:checked');if(obj.val()=="new")var $text=$.translate("coupons.create.users.filters.registration.new");else if(obj.val()=="old")$text=$.translate("coupons.create.users.filters.registration.old");else $text=$.html_encoder.decode("\x26ndash;");$('[data-for\x3d"registration-filters"]').text($text)})();
break;case "registered_from":case "registered_to":(function(){var display=[];var registered_from=$('[name\x3d"registered_from"]');var registered_to=$('[name\x3d"registered_to"]');if(registered_from.val())display.push($.translate("coupons.create.from")+" "+registered_from.val());if(registered_to.val())display.push($.translate("coupons.create.to")+" "+registered_to.val());$('[data-for\x3d"registration-filters"]').text(display.join(" - "))})();break;case "amount_from":case "amount_to":(function(){var display=
[];var amount_from=$('[name\x3d"amount_from"]');var amount_to=$('[name\x3d"amount_to"]');if(amount_from.val())display.push($.translate("coupons.create.from")+" "+amount_from.val()+$.html_encoder.decode("\x26euro;"));if(amount_to.val())display.push($.translate("coupons.create.to")+" "+amount_to.val()+$.html_encoder.decode("\x26euro;"));$('[data-for\x3d"order-filters"]').text(display.join(" - "))})();break;case "orders_filter":(function(){var obj=$('[name\x3d"orders_filter"]:checked');if(obj.val()==
"never")var $text=$.translate("coupons.create.users.filters.orders.never");else $text=$.html_encoder.decode("\x26ndash;");$('[data-for\x3d"order-filters"]').text($text)})();break;case "combine_offer":case "combine_coupons":case "trigger_on_user_custom_price":$('[data-for\x3d"'+shift+'"]').html(source.prop("checked")?check:unavail);break;case "discount_type":$('[data-for^\x3d"tier_"]').each(function(){var obj=$(this);var regExp=new RegExp(/[0-9]/);if(regExp.test(obj.text()))obj.text(obj.text().replace(/€|%/,
source.val()=="fixed"?$.html_encoder.decode("\x26euro;"):$.html_encoder.decode("\x26percnt;")))});$('[data-for\x3d"'+shift+'"]').text(source.next("span").text());break;case "apply_to":$('[data-for^\x3d"tier_"]').text($.html_encoder.decode("\x26ndash;"));break;case "amount":value=source.val();$('[id^\x3d"tier_"]').val("");if(value)if($('[name\x3d"discount_type"]:checked').val()=="fixed")value+=$.html_encoder.decode("\x26euro;");else value+=$.html_encoder.decode("\x26percnt;");else value=$.html_encoder.decode("\x26ndash;");
$('[data-for^\x3d"tier_"]').text(value);break;case "tier_1":case "tier_2":case "tier_3":case "tier_4":case "tier_5":case "tier_6":value=source.val();$("#amount").val("");if(value)if($('[name\x3d"discount_type"]:checked').val()=="fixed")value+=$.html_encoder.decode("\x26euro;");else value+=$.html_encoder.decode("\x26percnt;");else value=$.html_encoder.decode("\x26ndash;");$('[data-for\x3d"'+shift+'"]').text(value);break;case "status-trigger":updateStatusDisplay(source);break}});$("#seeAllSelectedUsers").on("click",
function(e){e.preventDefault();$("#allSelectedUsers").modal_open()});var merge={submit:submitCoupon};if("coupon_create"in $)$.extend($.coupon_create,merge);else $.extend({"coupon_create":merge});$("#couponSubmit").on("click",function(e){e.preventDefault()});$(document).on("change","#triggers_step .product_form",function(){try{clearTimeout(display_trigger_changes_timer)}catch(er){}display_trigger_changes_timer=setTimeout(function(){displayTriggerChanges()},250)}).on("change","#constraints_step .product_form",
function(){try{clearTimeout(display_constraint_changes_timer)}catch(er){}display_constraint_changes_timer=setTimeout(function(){displayConstraintChanges()},250)}).on("click","#triggers_step .add",function(e){e.preventDefault();try{clearTimeout(clone_trigger_display_timer)}catch(er){}clone_trigger_display_timer=setTimeout(function(){cloneTriggerDisplay()},250)}).on("click","#triggers_step .remove",function(e){e.preventDefault();try{clearTimeout(remove_trigger_display_timer)}catch(er){}remove_trigger_display_timer=
setTimeout(function(){removeTriggerDisplay()},250)}).on("click","#constraints_step .add",function(e){e.preventDefault();try{clearTimeout(clone_constraint_display_timer)}catch(er){}clone_constraint_display_timer=setTimeout(function(){cloneConstraintDisplay()},250)}).on("click","#constraints_step .remove",function(e){e.preventDefault();try{clearTimeout(remove_constraint_display_timer)}catch(er){}remove_constraint_display_timer=setTimeout(function(){removeConstraintDisplay()},250)}).on("click",".more-products",
function(e){e.preventDefault();var obj=$(this);var allProducts=$("#allProducts");allProducts.html("");$("#"+obj.attr("data-target")+" option:selected:not(:disabled)").each(function(){allProducts.append("\x3cli\x3e"+$(this).text()+"\x3c/li\x3e")});allSelectedProducts.modal_open()}).on("change",".select_product",function(){var multipleFound=false;$(".select_product").each(function(){var obj=$(this);if(obj.val()&&obj.val().length>1){multipleFound=true;return false}});if(multipleFound)$("#multipleProductsNotice").show();
else $("#multipleProductsNotice").hide()})});$(window).on("load",function(){$("#trigger_start, #trigger_end, #constraints_start, #constraints_end").each(function(){var obj=$(this);if(obj.val())obj.trigger("change")})});
